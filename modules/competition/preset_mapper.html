<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Preset Mapper â€¢ XGAMES</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/styles.css" />
</head>
<body style="background:#f8fafc;padding:24px;font-family:sans-serif;">
  <h1>ðŸ§© Preset Mapper</h1>
  <p>Select a preset to view and confirm event parameters.</p>

  <label>Preset:</label>
  <select id="presetSelect"></select>

  <div id="presetDetails" style="margin-top:20px;">
    <table border="1" cellpadding="6" cellspacing="0" style="border-collapse:collapse;">
      <tbody id="presetTableBody"></tbody>
    </table>
  </div>

  <button id="saveBtn" class="btn primary" style="margin-top:20px;">ðŸ’¾ Save & Return</button>

  <script src="/shared/core.js"></script>
  <script src="/shared/state.js"></script>
  <script src="/shared/presets.js"></script>
  <script src="/shared/preset_adapter.js"></script>
  <script src="/shared/ui.js"></script>

  <script>
    (function(){
      const cid = Core.getParam('cid');
      const select = document.getElementById('presetSelect');
      const tableBody = document.getElementById('presetTableBody');
      const saveBtn = document.getElementById('saveBtn');

      // Populate dropdown
      Preset.list().forEach(p => {
        const opt = document.createElement('option');
        opt.value = p.id;
        opt.textContent = p.name;
        select.appendChild(opt);
      });

      // Display selected preset details
      select.addEventListener('change', () => {
        const p = Preset.get(select.value);
        tableBody.innerHTML = '';
        if (!p) return;
        Object.entries(p).forEach(([k,v]) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td><b>${k}</b></td><td>${Array.isArray(v)?v.join(', '):v}</td>`;
          tableBody.appendChild(tr);
        });
      });

      // Save snapshot
      saveBtn.addEventListener('click', () => {
        const id = select.value;
        const p = Preset.get(id);
        if (!cid || !id || !p) return UI.toast('Missing preset or CID');
        State.setJSON('preset_snapshot_'+cid, p);
        UI.toast('Preset saved for CID '+cid);
        setTimeout(() => { window.location.href = './setup_new.html?cid='+encodeURIComponent(cid); }, 1000);
      });
    })();
  </script>
</body>
</html>
