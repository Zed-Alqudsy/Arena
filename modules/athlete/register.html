<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Athlete Registration • XGAMES</title>

  <!-- Keep your existing shared includes/paths -->
  <link rel="stylesheet" href="/styles.css">

  <script src="/shared/core.js"></script>
  <script src="/shared/ui.js"></script>
  <script src="/shared/state.js"></script>
  <script src="/shared/lang.js"></script>


  <style>
    :root {
      --blue: #2563eb;
      --navy: #1e3a8a;
      --orange: #F37021;
      --bg: #f8fafc;
      --card: #fff;
      --ink: #0f172a;
      --muted: #475569;
      --line: #e5e7eb;
      --soft: #f1f5f9;
      --btn: #0ea5e9;
      --btn-ink: #fff;
    }

    body {
      background: var(--bg);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      color: var(--ink);
      margin: 0;
    }

    /* Full-width blue gradient hero (no markup change) */
    header {
      padding: 72px 20px 96px;
      background: linear-gradient(180deg, var(--blue) 0%, var(--navy) 100%);
      color: #fff;
      text-align: center;
    }

    header h1 {
      margin: 0;
      font-size: 32px;
      font-weight: 800;
      letter-spacing: .2px;
    }

    /* Floating overlap container (same .wrap as yours) */
    .wrap {
      max-width: 880px;
      margin: -56px auto 0;
      /* creates the floating effect under the hero */
      padding: 0 16px 64px;
    }

    /* Card look aligned to centers */
    .card {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 16px;
      box-shadow: 0 10px 24px rgba(0, 0, 0, .06);
    }

    .card h2 {
      margin: 0;
      padding: 18px 20px;
      border-bottom: 1px solid #f1f5f9;
      font-size: 18px;
    }

    .card .body {
      padding: 20px;
    }

    /* Your existing grid helpers (kept, just made responsive) */
    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .row-3 {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 16px;
    }

    .row-1 {
      display: block;
    }

    @media (max-width: 760px) {

      .row,
      .row-3 {
        grid-template-columns: 1fr;
      }
    }

    label {
      display: block;
      font-size: 12px;
      color: #334155;
      margin-bottom: 6px;
    }

    input,
    select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #cbd5e1;
      border-radius: 10px;
      background: #fff;
      font-size: 14px;
      transition: border-color .2s, box-shadow .2s;
    }

    input:focus,
    select:focus {
      outline: none;
      border-color: var(--blue);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, .15);
    }

    input[readonly] {
      background: #f8fafc;
      color: #475569;
    }

    .actions {
      display: flex;
      gap: 12px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 10px 14px;
      border-radius: 10px;
      border: 1px solid var(--btn);
      background: var(--btn);
      color: var(--btn-ink);
      font-weight: 700;
      cursor: pointer;
      letter-spacing: .2px;
      transition: transform .15s ease, box-shadow .2s ease, background .2s ease, border-color .2s ease;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 18px rgba(14, 165, 233, .25);
    }

    .btn.secondary {
      background: #fff;
      color: var(--btn);
    }

    .hint {
      color: #64748b;
      font-size: 12px;
      margin-top: 6px;
    }

    /* Footer kept same, just aligned style tokens */
    footer {
      padding: 20px;
      text-align: center;
      background: #eef2f7;
      color: var(--muted);
      border-top: 1px solid var(--line);
      margin-top: 24px;
    }

    a {
      color: var(--btn);
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }
  </style>

</head>

<body>
  <header>
    <h1>Register as Athlete</h1>
  </header>

  <main class="wrap" style="max-width:880px;margin:24px auto;padding:16px;">
    <div class="card"
      style="background:#fff;border:1px solid #e5e7eb;border-radius:12px;box-shadow:0 1px 2px rgba(0,0,0,.04);">
      <h2 style="margin:0;padding:18px 20px;border-bottom:1px solid #f1f5f9;font-size:18px;">Athlete Details</h2>
      <div class="body" style="padding:20px;">
        <form id="regForm" novalidate>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
            <div>
              <label for="nsid" style="display:block;font-size:12px;color:#334155;margin-bottom:6px;">MSF ID (auto if
                blank)</label>
              <input id="nsid" name="nsid" type="text" placeholder="e.g. NSID-MSF-2025-00001" />
              <div class="hint" style="color:#64748b;font-size:12px;margin-top:6px;">Leave empty to auto-generate.</div>
            </div>
            <div>
              <label for="name" style="display:block;font-size:12px;color:#334155;margin-bottom:6px;">Full Name</label>
              <input id="name" name="name" type="text" placeholder="e.g. Ali Bin Ahmad" required />
            </div>
          </div>

          <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:16px;">
            <div>
              <label for="nation" style="display:block;font-size:12px;color:#334155;margin-bottom:6px;">Nation</label>
              <input id="nation" name="nation" type="text" placeholder="e.g. MAS" />
            </div>
            <div>
              <label for="club" style="display:block;font-size:12px;color:#334155;margin-bottom:6px;">Club</label>
              <input id="club" name="club" type="text" placeholder="e.g. Selangor Skate" />
            </div>
          </div>

          <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:16px;">
            <div>
              <label for="state" style="display:block;font-size:12px;color:#334155;margin-bottom:6px;">State</label>
              <input id="state" name="state" type="text" placeholder="e.g. Selangor" required />
            </div>
            <div>
              <label for="district"
                style="display:block;font-size:12px;color:#334155;margin-bottom:6px;">District</label>
              <input id="district" name="district" type="text" placeholder="e.g. Petaling" required />
            </div>
          </div>

          <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;margin-top:16px;">
            <div>
              <label for="dob" style="display:block;font-size:12px;color:#334155;margin-bottom:6px;">Date of
                Birth</label>
              <input id="dob" name="dob" type="date" required />
            </div>
            <div>
              <label for="age" style="display:block;font-size:12px;color:#334155;margin-bottom:6px;">Age (auto)</label>
              <input id="age" name="age" type="number" readonly />
            </div>
            <div>
              <label for="sex" style="display:block;font-size:12px;color:#334155;margin-bottom:6px;">Sex</label>
              <select id="sex" name="sex" required>
                <option value="">Select…</option>
                <option value="M">Male</option>
                <option value="F">Female</option>
              </select>
            </div>
          </div>

          <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:16px;">
            <div>
              <label for="contact" style="display:block;font-size:12px;color:#334155;margin-bottom:6px;">Contact</label>
              <input id="contact" name="contact" type="text" placeholder="+60…" />
            </div>
            <div>
              <label for="fid" style="display:block;font-size:12px;color:#334155;margin-bottom:6px;">Federation
                (FID)</label>
              <input id="fid" name="fid" type="text" placeholder="e.g. MSF" />
              <div class="hint" style="color:#64748b;font-size:12px;margin-top:6px;">Defaults to MSF if blank.</div>
            </div>
          </div>

          <div style="margin-top:16px;">
            <label for="national_id" style="display:block;font-size:12px;color:#334155;margin-bottom:6px;">IC / Passport
              (private, not shown publicly)</label>
            <input id="national_id" name="national_id" type="text" placeholder="e.g. 900101-14-XXXX" required />
            <div class="hint" style="color:#64748b;font-size:12px;margin-top:6px;">Required for verification. Stored
              only in federation records.</div>
          </div>

          <div class="actions" style="display:flex;gap:12px;margin-top:20px;">
            <button class="btn" type="submit"
              style="padding:10px 14px;border-radius:10px;border:1px solid #0ea5e9;background:#0ea5e9;color:#fff;font-weight:600;cursor:pointer;">Submit
              Registration</button>
            <button class="btn secondary" type="button" id="resetBtn"
              style="padding:10px 14px;border-radius:10px;border:1px solid #0ea5e9;background:#fff;color:#0ea5e9;font-weight:600;cursor:pointer;">Reset</button>
          </div>
          <div class="hint" style="color:#64748b;font-size:12px;margin-top:6px;">On submit, your record goes to
            federation <b>staging</b> for approval.</div>
        </form>
      </div>
    </div>

  </main>


  <!-- Replace your entire <footer> ... </footer> with this -->
  <footer style="padding:20px;text-align:center;background:#eef2f7;margin-top:24px;">
    <a href="/pages/athlete_center.html" style="color:#0ea5e9;text-decoration:none;">⬅️ Back to Athlete Center</a>
  </footer>


  <script>
    (function () {
      const $ = (id) => document.getElementById(id);
      const toast = (msg, ok = true) => (window.UI && UI.toast)
        ? UI.toast(msg, ok ? 'success' : 'error')
        : alert(msg);

      // Auto-compute age when DOB changes
      $('dob').addEventListener('change', () => {
        const age = State.computeAge($('dob').value);
        $('age').value = (age ?? '');
      });

      // Reset
      $('resetBtn').addEventListener('click', () => {
        $('regForm').reset();
        $('age').value = '';
      });

      // Submit handler
      $('regForm').addEventListener('submit', (e) => {
        e.preventDefault();

        // Gather values
        const nsid = $('nsid').value.trim();
        const name = $('name').value.trim();
        const nation = $('nation').value.trim() || 'MAS';
        const state = $('state').value.trim();
        const district = $('district').value.trim();
        const dob = $('dob').value;
        const age = State.computeAge(dob);
        const sex = $('sex').value;
        const club = $('club').value.trim();
        const contact = $('contact').value.trim();
        const fid = $('fid').value.trim() || 'MSF';

        // Validate requireds
        if (!nsid || !name || !state || !district || !dob || !sex) {
          toast('Please fill all required fields (NSID, Name, State, District, DOB, Sex).', false);
          return;
        }
        if (!age && age !== 0) {
          toast('Invalid DOB.', false);
          return;
        }
        if (!['M', 'F'].includes(sex)) {
          toast('Select Male or Female.', false);
          return;
        }

        // De-dupe guards: block if nsid already in master or staging
        const K_STAGING = State.keys.athletesStaging;
        const K_MASTER = State.keys.athletesMaster;
        const staging = State.arr(K_STAGING);
        const master = State.arr(K_MASTER);

        const inStaging = staging.some(a => (a.nsid || '').toLowerCase() === nsid.toLowerCase());
        const inMaster = master.some(a => (a.nsid || '').toLowerCase() === nsid.toLowerCase());
        if (inStaging || inMaster) {
          toast('NSID already exists. If you believe this is an error, contact the federation.', false);
          return;
        }

        // Build record
        const rec = {
          nsid, fid, name, nation, state, district, dob, age, sex, club, contact,
          createdAt: new Date().toISOString()
        };

        // Write to staging (unique by nsid)
        State.pushUnique(K_STAGING, rec, (a, b) => (a.nsid || '').toLowerCase() === (b.nsid || '').toLowerCase());
        State.bumpTick(State.keys.tickAthletesMaster);

        toast('Registration submitted. Pending federation approval.');
        // Optional: clear form after success
        $('regForm').reset();
        $('age').value = '';
      });
    })();
  </script>
  <script>
    (function () {
      const $ = (id) => document.getElementById(id);
      const toast = (msg, ok = true) => (window.UI && UI.toast)
        ? UI.toast(msg, ok ? 'success' : 'error')
        : alert(msg);

      // Auto age
      $('dob').addEventListener('change', () => {
        $('age').value = State.computeAge($('dob').value) ?? '';
      });

      // Reset
      $('resetBtn').addEventListener('click', () => {
        $('regForm').reset();
        $('age').value = '';
      });

      // Submit
      $('regForm').addEventListener('submit', (e) => {
        e.preventDefault();

        // Read fields
        let nsid = $('nsid').value.trim();                 // may be blank → auto-generate
        const name = $('name').value.trim();
        const nation = $('nation').value.trim() || 'MAS';
        const state = $('state').value.trim();
        const district = $('district').value.trim();
        const dob = $('dob').value;
        const age = State.computeAge(dob);
        const sex = $('sex').value;
        const club = $('club').value.trim();
        const contact = $('contact').value.trim();
        const fid = $('fid').value.trim() || 'MSF';
        const national_id = $('national_id').value.trim(); // required (private only)

        // Validate requireds
        if (!name || !state || !district || !dob || !sex || !national_id) {
          toast('Please fill all required fields (Name, State, District, DOB, Sex, IC/Passport).', false);
          return;
        }
        if (!['M', 'F'].includes(sex)) {
          toast('Select Male or Female.', false); return;
        }
        if (!age && age !== 0) {
          toast('Invalid DOB.', false); return;
        }

        // Auto-generate MSF ID if blank: NSID-<FID>-<YYYY>-<00001>
        if (!nsid) {
          const year = String(new Date().getFullYear());
          const CURSOR_KEY = `nsid_cursor_${fid}`;
          const cur = Number(localStorage.getItem(CURSOR_KEY) || '0') + 1;
          localStorage.setItem(CURSOR_KEY, String(cur));
          nsid = `NSID-${fid}-${year}-${String(cur).padStart(5, '0')}`;
          $('nsid').value = nsid; // show assigned ID
        }

        // De-dupe by NSID across staging + master
        const K_STAGING = State.keys.athletesStaging;
        const K_MASTER = State.keys.athletesMaster;
        const staging = State.arr(K_STAGING);
        const master = State.arr(K_MASTER);
        const lower = s => (s || '').toLowerCase();

        const exists = staging.some(a => lower(a.nsid) === lower(nsid)) ||
          master.some(a => lower(a.nsid) === lower(nsid));
        if (exists) {
          toast('MSF ID already exists — please use a different ID.', false);
          return;
        }

        // Build record — IC stays only in staging/master (private), never in per-CID publish
        const rec = {
          nsid, fid, name, nation, state, district, dob, age, sex, club, contact,
          national_id, // private
          createdAt: new Date().toISOString()
        };

        // Write to staging (unique by nsid)
        State.pushUnique(K_STAGING, rec, (a, b) => lower(a.nsid) === lower(b.nsid));
        State.bumpTick(State.keys.tickAthletesMaster);

        toast('Registration submitted. Pending federation approval.');
        $('regForm').reset();
        $('age').value = '';
      });
    })();
  </script>

</body>

</html>