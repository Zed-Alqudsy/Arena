<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Join Competition ‚Ä¢ XGAMES</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="/styles.css">

  <script src="/shared/core.js"></script>
  <script src="/shared/ui.js"></script>
  <script src="/shared/state.js"></script>
  <script src="/shared/lang.js"></script>
</head>

<body style="background:#f8fafc;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;color:#0f172a;margin:0;">

  <!-- ‚úÖ Arena Blue Header -->
  <header style="background:linear-gradient(180deg,#2563eb 0%,#1e3a8a 100%);
                 color:#fff;text-align:center;padding:72px 20px 96px;">
    <h1 style="margin:0;font-size:32px;font-weight:800;">Join Competition</h1>
    <p style="margin:8px 0 0;opacity:.92;">Submit your NSID to enter official events</p>
  </header>

  <!-- ‚úÖ Main Form -->
  <main style="max-width:720px;margin:-64px auto 48px auto;padding:0 24px;">
    <form id="joinForm" class="card" style="background:#fff;border:1px solid #e5e7eb;border-radius:16px;
             box-shadow:0 8px 24px rgba(0,0,0,.08);padding:32px;">
      <label style="display:block;font-size:14px;color:#334155;margin-bottom:8px;">
        NSID
        <input id="nsid" placeholder="NSID-MSF-2025-00001" required style="width:100%;padding:10px 12px;border:1px solid #cbd5e1;
                 border-radius:10px;margin-top:4px;font-size:14px;">
      </label>

      <label style="display:block;font-size:14px;color:#334155;margin-top:16px;margin-bottom:8px;">
        Category
        <input id="category" placeholder="e.g. Street Open Men" required style="width:100%;padding:10px 12px;border:1px solid #cbd5e1;
                 border-radius:10px;margin-top:4px;font-size:14px;">
      </label>

      <label style="display:block;font-size:14px;color:#334155;margin-top:16px;margin-bottom:8px;">
        Note
        <input id="note" placeholder="(optional)" style="width:100%;padding:10px 12px;border:1px solid #cbd5e1;
                 border-radius:10px;margin-top:4px;font-size:14px;">
      </label>

      <div style="margin-top:24px;text-align:center;">
        <button type="submit" style="padding:10px 20px;border:none;border-radius:10px;
                 background:#0ea5e9;color:#fff;font-weight:600;cursor:pointer;">
          Request Entry
        </button>
      </div>

      <p id="msg" class="muted" style="margin-top:12px;font-size:13px;
              color:#64748b;text-align:center;"></p>
    </form>

    <!-- ‚úÖ Navigation -->
    <div style="text-align:center;margin-top:24px;display:flex;flex-direction:column;gap:6px;">
      <a href="javascript:history.back()" style="color:#0ea5e9;text-decoration:none;">‚¨ÖÔ∏è Back to Previous Page</a>
      <a href="/pages/athlete_center.html" style="color:#0ea5e9;text-decoration:none;">üèÉ Back to Athlete Center</a>
    </div>
  </main>

  <!-- ‚úÖ Original Logic ‚Äî unchanged -->
  <script>
    (function () {
      const toast = (m, ok = true) => (window.UI && UI.toast) ? UI.toast(m) : alert(m);
      const cid = Core.getParam('cid');
      if (!cid) { toast('Missing ?cid', false); return; }

      const KEY_ENTRIES = State.keys.entriesStaging(cid);
      const KEY_TICK = State.keys.tickAthletesCID(cid);

      const $ = id => document.getElementById(id);
      const inMaster = (nsid) => {
        const m = State.arr(State.keys.athletesMaster);
        const t = String(nsid).trim().toUpperCase();
        return m.some(a => String(a.nsid || '').toUpperCase() === t);
      };
      const inEntries = (nsid) => {
        const rows = State.arr(KEY_ENTRIES);
        const t = String(nsid).trim().toUpperCase();
        return rows.some(r => String(r.nsid || '').toUpperCase() === t);
      };

      $('joinForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const nsid = $('nsid').value.trim().toUpperCase();
        const category = $('category').value.trim();
        const note = $('note').value.trim();

        if (!nsid) { toast('NSID required', false); return; }
        if (!inMaster(nsid)) { toast('NSID not found in federation registry.', false); return; }
        if (!category) { toast('Category required', false); return; }
        if (inEntries(nsid)) { toast('Already requested entry for this competition.', false); return; }

        const rec = { nsid, category, note, createdAt: new Date().toISOString() };
        State.push(State.keys.entriesStaging(cid), rec);
        State.bumpTick(KEY_TICK);
        $('joinForm').reset();
        $('msg').textContent = 'Entry submitted. Awaiting federation approval.';
      });
    })();
  </script>
</body>

</html>